!function(e,t){"use strict";function a(e){e.widget("paginateTable",{title:"Tableau Paginé",description:"Widget permettant d'afficher un tableau paginé",templateUrl:"{widgetsPath}/paginateTable/src/view/view.html",controller:"paginateTableController",controllerAs:"pt",reload:!0,resolve:{data:["paginateTableService","config",function(e,t){return e.get(t)}]},edit:{controller:"paginateTableEditController",controllerAs:"pt",templateUrl:"{widgetsPath}/paginateTable/src/edit/edit.html"}})}function o(e,t,a,o,n,l){var i=this;i.load=!1,a&&(this.data=a,this.data.currentPage=1,this.data.maxSize=5,this.orderField=0,this.reverseSort=!1,this.first=!0,this.sortIndex=function(e){return i.first=!1,i.reverseSort=!i.reverseSort,i.orderField=e},this.sorter=function(e){if(!i.first)return e[i.orderField].value},i.getData=function(){for(var e=angular.copy(i.data.rows),t=0;t<e.length;t++)for(var a=0;a<e[t].length;a++)e[t][a]=e[t][a].value;return e},i.getHeader=function(){return i.data.headers},i.data.config.listener&&e.$on("DatTest",function(e,t){i.data.config.expertReplace=t,i.data.config.urlReplace=t[i.data.config.slaveValue],i.load=!0,n.get(i.data.config).then(function(e){i.load=!1,i.data=e,i.data.maxSize=5,i.data.currentPage=1})}),i.verifSeuil=function(e,t,a){if(!isNaN(e)){if("Sup"==t)return e>a;if("Inf"==t)return e<a}},i.formatDate=function(e,t){return i.data.config.dateFormat||(i.data.config.dateFormat="YYYY-MM-DDTHH:mm:ssZ"),moment(e,i.data.config.dateFormat).format(t)},i.open=function(e){if(i.data.config.master||i.data.config.modalDatasource.selected||i.data.config.modalUrl){if(i.data.config.expertReplace)var a=i.data.config.expertReplace;else var a={};if(i.data.config.colToPop&&i.data.config.colToPop.forEach(function(t){a[t.name]=e.find(function(e){return e.title==t.name}).value}),i.data.config.master)return void t.$broadcast("DatTest",a);if(i.data.config.link)return void l.redirect(i.data.config,a);if(i.data.config.modalDatasource.selected&&(i.data.config.modalUrl=i.data.config.modalDatasource.selected.url),i.data.config.modalUrl){i.data.config.urlReplace=a[i.data.config.colToPop[0].name];o.open({templateUrl:"{widgetsPath}/paginateTable/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:["modalService",function(e){return e.get(i.data.config)}]}})}}})}function n(e,t,a){function o(e,t){var o=[];return angular.forEach(e.modalColumns,function(e,n){e.title&&e.path&&(t.headers[n]=e.title,o.push({title:e.title,path:a(e.path)}))}),o}function n(e,t){var n={headers:[],rows:[]};if(!e.modalColumns){e.modalColumns=[];for(var l in t[0])e.modalColumns.push({title:l,path:l})}var i=t;e.rootData&&(i=a(e.rootData)(t));var r=o(e,n);return angular.forEach(i,function(e){var t=[];angular.forEach(r,function(a,o){var n=a.path(e);t[o]=n}),n.rows.push(t)}),n.totalItems=n.rows.length,n.columns=e.columns,n}function l(e){var a=e.modalUrl.replace(/:\w*/,e.urlReplace);return t.get(a).then(function(e){return e.data}).then(function(t){return n(e,t)})}function i(e){var t=null;return e.modalDatasource&&(e.modalDatasource.selected&&(e.modalUrl=e.modalDatasource.selected.url),t=l(e)),t}return{get:i}}function l(e){var t=this;this.data=e,this.sortIndex=function(e){return t.reverseSort=!t.reverseSort,t.orderField=e},this.sorter=function(e){return e[t.orderField]}}function i(e,t,a){function o(e){i.config.principalCol=[],i.config.otherCol=[],e.forEach(function(e){"principal"==e.type?i.config.principalCol.push(e):i.config.otherCol.push(e)})}function n(e){return e||a.columns||(a.columns=[]),e&&!a.modalColumns&&(a.modalColumns=[]),e?a.modalColumns:a.columns}function l(){return a.colToPop||(a.colToPop=[]),a.colToPop}var i=this;this.config=a,a.datasource={},a.modalDatasource={},a.urlReplace="0",i.config.principalCol||(i.config.principalCol=[]),i.config.otherCol||(i.config.otherCol=[]),a.condition||(a.condition={group:{operator:"AND",rules:[]}}),a.condition2||(a.condition2={group:{operator:"AND",rules:[]}}),this.getDatabase=function(){return t.get("/standard").then(function(e){return e.data})},this.getStandardColumns=function(e){return t.get("/standard/columns",{params:{val:e}}).then(function(e){return e.data}).then(function(e){o(e)})},this.formatLabel=function(e){return a.keys[e]},this.addColToPop=function(){l().push({})},this.removeColToPop=function(e){l().splice(e,1)},this.addColumn=function(e){n(e).push({})},this.removeColumn=function(e,t){n(e).splice(t,1)}}function r(e,t,a){function o(e,t){var o=[];angular.forEach(e.columns,function(e,n){e.title&&e.path&&(t.headers[n]=e.title,o.push({title:e.title,path:a(e.path),opt:e.opt}))});var n=e.keys.filter(function(t){return!e.columns.find(function(e){return e.title==t})});return angular.forEach(n,function(e,t){o.push({title:e,path:a(e),opt:"hidden"})}),o}function n(e,t){var n={headers:[],rows:[],itemPerPage:e.itemPerPage};e.keys=[];for(var l in t[0])e.keys.push(l);if(e.clear&&(e.columns=[]),!e.columns||!e.columns.length){e.columns=[];for(var i in t[0]){var r=i.replace(/_/g," ");r=r.replace(/^bool/,""),e.columns.push({title:r,path:i,col:null})}}var c=t;e.root&&(c=a(e.root)(t));var d=o(e,n);return angular.forEach(c,function(e){var t=[];angular.forEach(d,function(a,o){var n=a.path(e);t[o]={value:n,opt:a.opt,title:a.title}}),n.rows.push(t)}),n.totalItems=n.rows.length,n.columns=e.columns,n.config=e,n}function l(e){var a=e.url.replace(/:\w+/,e.urlReplace);return t.get(a).then(function(e){return e.data}).then(function(t){return n(e,t)})}function i(e,a){return t.post(a,e).then(function(e){return e.data}).then(function(t){return n(e,t)})}function r(e){var t=null;return"exp"==e.mode?t=i(e,c):"std"==e.mode?t=i(e,d):"easy"==e.mode&&(e.datasource.selected&&(e.url=e.datasource.selected.url),t=l(e)),t}var c="/expert/query",d="/standard/";return{get:r}}angular.module("adf.widget.paginateTable",["adf.provider","dashboardInfra.service"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.paginateTable").run(["$templateCache",function(e){e.put("{widgetsPath}/paginateTable/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><div class="form-inline padding-bottom"><input type=checkbox ng-model=config.master id=master> <label for=master>Master</label> <input ng-if="config.mode == \'easy\' || \'expert\'" id=listener type=checkbox ng-model=config.listener> <label ng-if="config.mode == \'easy\' || \'expert\'" for=listener>Slave</label><div ng-if=config.listener><label>Master Column</label> <input type=text ng-model=config.slaveValue></div></div><form role=form><hr><input type=radio ng-model=config.mode value=easy id=easy> <label for=easy>Mode Facile</label> <input type=radio ng-model=config.mode value=std id=std> <label for=std>Mode Standard</label> <input type=radio ng-model=config.mode value=exp id=exp> <label for=exp>Mode Expert</label><div class=form-group ng-if="config.mode == \'easy\'"><easy-mode config=config><easy-mode></easy-mode></easy-mode></div><div class=form-group ng-if="config.mode == \'std\'"><div class=form-group><label for=sample>Datasources</label> <input id=sample type=text class=form-control ng-model=config.databaseStandard placeholder="Type du Check" autocomplete=off uib-typeahead="database for database in pt.getDatabase($viewValue)" typeahead-min-length=0 typeahead-on-select=pt.getStandardColumns(config.databaseStandard)></div><div class=form-group><label for=standardTest>Condition :</label></div><p ng-hide=config.principalCol.length>Choissisez une datasource !</p><div ng-if=config.principalCol.length><label><small>Choix de la Référence</small></label><query-builder group=config.condition.group fields=config.principalCol database=config.databaseStandard></query-builder></div><div ng-if="config.condition.group.rules[0] && config.condition.group.rules[0].data"><label><small>Conditions Optionnelles</small></label><query-builder group=config.condition2.group fields=config.otherCol database=config.databaseStandard></query-builder></div></div><div ng-if="config.mode == \'exp\'"><expert-mode config=config></expert-mode></div><hr><div><label>Colonne</label></div><p>Première configuration automatique</p><div ng-repeat="col in pt.config.columns"><div class="form-inline padding-bottom"><div class=form-group><label class=ctm-label for=title-{{$index}}>Nom de la colonne :</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=ctm-label for=path-{{$index}}>Chemin d\'accès :</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required autocomplete=off uib-typeahead="key for key in config.keys" typeahead-min-length=0></div></div><div class="form-inline padding-bottom" ng-init="col.opt = {}"><label for=opt-{{$index}}>Booléen</label> <input type=radio id=opt-{{$index}} ng-model=col.opt.type value=bool> <label for=opt4-{{$index}}>Check</label> <input type=radio id=opt4-{{$index}} ng-model=col.opt.type value=check> <label for=opt2-{{$index}}>Seuil</label> <input type=radio id=opt2-{{$index}} ng-model=col.opt.type value=seuil> <label for=opt3-{{$index}}>Pourcentage</label> <input type=radio id=opt3-{{$index}} ng-model=col.opt.type value=pourcent> <label for=opt4-{{index}}>Date</label> <input type=radio id=opt4-{{index}} ng-model=col.opt.type value=date></div><div class="form-inline padding-bottom" ng-if="col.opt.type ==\'pourcent\'"><label for=ip>Inverser les couleurs</label> <input id=ip type=checkbox ng-model=col.opt.inversePourcent></div><div class="form-inline padding-bottom" ng-if="col.opt.type == \'seuil\'"><select ng-model=col.opt.seuilOp><option value=Sup>Sup</option><option value=Inf>Inf</option><option value=Eg>Egal</option></select><input type=text ng-model=col.opt.seuilVal></div><div class="form-inline padding-bottom" ng-if="col.opt.type == \'date\'"><label for=format>Format de la Date</label><select ng-model=col.opt.dateFormat><option value=DD-MM-YYYY>Day - Month - Year</option><option value=DD-MMM>Day - Month</option><option value=DD-HH>Day</option><option value=X>Timestamp</option></select></div><button type=button class="btn btn-warning" ng-click="pt.removeColumn(false, $index)"><i class="fa fa-minus"></i> Remove</button><hr></div><br><button type=button class="btn btn-primary" ng-click=pt.addColumn(false)><i class="fa fa-plus"></i> Add</button><hr><div><input type=checkbox id=header ng-model=config.head> <label for=header>Cacher l\'en-tête</label></div><div><input type=checkbox id=filter ng-model=config.filter> <label for=filter>Cacher le Filtre</label></div><div><label for=clear>Effacer les colonnes à chaque chargement</label> <input type=checkbox ng-model=config.clear id=clear></div><div><label>Pagination</label></div><div class=form-group><label class=sr-only for=maxSize>Nombre d\'Elément par Page</label> <input type=text id=maxSize class=form-control placeholder="Nombre d\'élément par pages" ng-model=config.itemPerPage></div><div class=form-group><p>Si vous avez choissis un type date pour une colonne veuillez spécifier le format de la date de la BDD</p><label class=ctm-label for=df>Format</label> <input type=text placeholder="Par Default : YYYY-MM-DDTHH:mm:ssZ" ng-model=config.dateFormat></div><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Optionnel <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><hr><div><label for=field>Column to populate</label></div><div class="form-inline padding-bottom" ng-repeat="c in pt.config.colToPop"><div class=form-group><input type=text id=field autocomplete=off uib-typeahead="key for key in config.keys" typeahead-min-length=0 ng-model=c.name></div><button type=button class="btn btn-warning" ng-click=pt.removeColToPop($index)><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=pt.addColToPop()><i class="fa fa-plus"></i> Add</button><hr><my-link config=config></my-link><hr><label>Modal Configuration</label><modal-config config=config></modal-config></div></form>'),e.put("{widgetsPath}/paginateTable/src/view/modal.html","<modal-table data=cm.data></modal-table>"),e.put("{widgetsPath}/paginateTable/src/view/view.html",'<div><div ng-hide=pt.data class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=pt.data><div class=row><div ng-if=!pt.data.config.head class=col-md-12><div class="col-md-6 text-center v-cent"><p>Nombre d\'éléments : {{pt.data.rows.length}}</p></div><div class="col-md-6 text-center marg"><button type=button class="btn btn-success" ng-csv=pt.getData() csv-header=pt.getHeader() field-separator=; filename="{{$parent.model.title + \'.csv\'}}"><i class="fa fa-file-excel-o" aria-hidden=true></i> Export</button></div><br></div></div><div class=text-center ng-show=!config.filter><input type=search ng-model=q placeholder=Filter class=form-control></div><div ng-show=!pt.load class=table-responsive><table class=table><tr><th class=text-center ng-repeat="head in pt.data.headers" ng-click=pt.sortIndex($index)>{{head}}</th></tr><tr ng-repeat="row in filterData = (pt.data.rows | myfilter:pt.data.headers:q | orderBy:pt.sorter:pt.reverseSort) | startFrom: (pt.data.currentPage-1)*pt.data.itemPerPage | limitTo:pt.data.itemPerPage track by $index" ng-click=pt.open(row)><td ng-repeat="col in row track by $index" ng-switch=col.opt.type ng-if="col.opt != \'hidden\'" ng-class="{click : pt.data.config.master || pt.data.config.modalUrl}"><span ng-switch-default>{{col.value}}</span><span ng-switch-when=bool ng-if="(col.value != \'0\') && (col.value != \'1\')">{{col.value}}</span> <span ng-switch-when=bool ng-if="col.value == \'0\'"><i class="fa fa-times text-danger"></i></span> <span ng-switch-when=bool ng-if="col.value == \'1\'"><i class="fa fa-check text-success"></i></span><span ng-switch-when=seuil ng-if="pt.verifSeuil(col.value, col.opt.seuilOp, col.opt.seuilVal)" class=text-success>{{col.value}}</span> <span ng-switch-when=seuil ng-if="!pt.verifSeuil(col.value, col.opt.seuilOp, col.opt.seuilVal)" class=text-danger>{{col.value}}</span><span ng-switch-when=pourcent ng-if="col.value < 0" class="fa fa-arrow-down" ng-class="{\'text-success\' : !col.opt.inversePourcent, \'text-danger\': col.opt.inversePourcent}" uib-tooltip={{col.value}}%></span> <span ng-switch-when=pourcent ng-if="col.value > 0" class="fa fa-arrow-up" ng-class="{\'text-success\' : col.opt.inversePourcent, \'text-danger\': !col.opt.inversePourcent}" uib-tooltip={{col.value}}%></span> <span ng-switch-when=pourcent ng-if="col.value == 0" class="fa fa-arrow-right text-warning" uib-tooltip={{col.value}}%></span><span ng-switch-when=check ng-if="col.value > 0"><i class="fa fa-times text-danger" uib-tooltip={{col.value}}></i></span> <span ng-switch-when=check ng-if="col.value == 0"><i class="fa fa-check text-success" uib-tooltip={{col.value}}></i></span><span ng-switch-when=date>{{pt.formatDate(col.value, col.opt.dateFormat)}}</span></td></tr></table></div><div ng-if="pt.data.rows.length == 0" class=text-center><span><i class="fa fa-flag"></i> No Result Found</span></div><div ng-hide=!pt.load class=text-center><i class="fa fa-spinner fa-pulse fa-3x" aria-hidden=true></i></div><div class=text-center ng-if="filterData.length > pt.data.itemPerPage"><ul uib-pagination total-items=filterData.length ng-model=pt.data.currentPage max-size=5 class=pagination-sm boundary-links=true items-per-page=pt.data.itemPerPage num-pages=numPages></ul></div></div></div>')}]),angular.module("adf.widget.paginateTable").controller("paginateTableController",o),o.$inject=["$scope","$rootScope","data","$uibModal","paginateTableService","link"],angular.module("adf.widget.paginateTable").service("modalService",n),n.$inject=["$q","$http","$parse"],angular.module("adf.widget.paginateTable").controller("modalInstanceCtrl",l),l.$inject=["data"],angular.module("adf.widget.paginateTable").controller("paginateTableEditController",i),i.$inject=["$scope","$http","config"],angular.module("adf.widget.paginateTable").service("paginateTableService",r),r.$inject=["$q","$http","$parse"],angular.module("adf.widget.paginateTable").filter("startFrom",function(){return function(e,t){if(e&&e.length)return e.slice(t)}}).filter("myfilter",function(){return function(e,t,a){if(!a)return e;var o=a.match(/\w+:\w+/gi);if(1==o.length){var n=t.indexOf(a.match(/\w+/)[0]),l=a.match(/:\w+/)[0].substr(1);return e.filter(function(e,t,a){var o=e[n].value;return"number"==typeof o&&(o+=""),o.indexOf(l)>-1})}return o.length>1?e.filter(function(e,a,n){return o.every(function(a){var o=t.indexOf(a.match(/\w+/)[0]),n=a.match(/:\w+/)[0].substr(1),l=e[o].value;return"number"==typeof l&&(l+=""),l.indexOf(n)>-1})}):e.filter(function(e,t,o){return e.some(function(e){var t=e.value;return"number"==typeof t&&(t+=""),t.indexOf(a)>-1})})}})}(window);