!function(e,a){"use strict";function t(e){e.widget("pieChart",{title:"Camembert",description:"Widget permettant l'affichage de Camembert",templateUrl:"{widgetsPath}/pieChart/src/view/view.html",controller:"pieChartController",controllerAs:"graph",reload:!0,resolve:{data:["pieChartService","config",function(e,a){return e.get(a)}]},edit:{controller:"pieChartEditController",controllerAs:"graph",templateUrl:"{widgetsPath}/pieChart/src/edit/edit.html"}})}function l(e,a,t,l){if(a){var o=this;this.config=a.config,this.label=a.label,this.value=a.value,this.type=a.type,this.desc=a.desc;var i;i="doughnut"==this.type?75:0,this.options={elements:{arc:{borderWidth:1,borderColor:"#222222"}},legend:{display:!0,position:"left"},cutoutPercentage:i},a.config.listener&&l.$on("DatTest",function(e,a){o.config.urlReplace=a,o.load=!0,t.get(o.config).then(function(e){o.load=!1,o.label=e.label,o.value=e.value})})}}function o(e,a,t,l){function o(e){e.forEach(function(e){"principal"==e.type?i.config.principalCol.push(e):i.config.otherCol.push(e)})}var i=this;this.config=t,t.datasource={},i.config.principalCol||(i.config.principalCol=[]),i.config.otherCol||(i.config.otherCol=[]),t.condition||(t.condition={group:{operator:"AND",rules:[]}}),t.condition2||(t.condition2={group:{operator:"AND",rules:[]}}),this.getDatabaseExpert=function(){return a.get("/expert").then(function(e){return e.data})},this.getDatabase=function(){return a.get("/standard").then(function(e){return e.data})},this.getColumns=function(e){return a.get("/standard/columns",{params:{val:e}}).then(function(e){return e.data}).then(function(e){o(e),i.column=e})}}function i(e,a,t){function l(e,a){var l,o;a.key=[];for(var i in e[0])a.key.push(i);return a.label||(a.label=a.key[0]),a.value||(a.value=a.key[1]),l=t(a.label),o=t(a.value),c=e.map(function(e){return l(e)}),s=e.map(function(e){return o(e)}),{config:a,label:c,value:s,type:a.type,desc:a.desc}}function o(e){var t=e.url.replace(/:\w*/,e.urlReplace);return a.get(t).then(function(e){return e.data}).then(function(a){return l(a,e)})}function i(e){var a=null;return"exp"==e.mode?a=r(e,n):"std"==e.mode?a=r(e,d):"easy"==e.mode&&(e.datasource.selected&&(e.url=e.datasource.selected.url),a=o(e)),a}function r(e,t){return a.post(t,e).then(function(e){return e.data}).then(function(a){return l(a,e)})}var n="/expert/query",d="/standard/graph",c=[],s=[];return{get:i}}angular.module("adf.widget.pieChart",["adf.provider"]).config(t),t.$inject=["dashboardProvider"],angular.module("adf.widget.pieChart").run(["$templateCache",function(e){e.put("{widgetsPath}/pieChart/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><form role=form><div><label>Description</label></div><div class=form-group><label class=sr-only for=desc>Description</label> <input type=text id=desc class=form-control ng-model=config.desc placeholder=Description></div><hr><input type=radio ng-model=config.mode value=easy id=easy> <label for=easy>Mode Facile</label> <input type=radio ng-model=config.mode value=std id=std> <label for=std>Mode Standard</label> <input type=radio ng-model=config.mode value=exp id=exp> <label for=exp>Mode Expert</label><div class=form-group ng-if="config.mode == \'easy\'"><label for=sample>Datasource</label><div ng-show=config.url class="alert alert-info text-center">{{config.url}}</div><selecttree model=config.datasource></selecttree></div><div class=form-group ng-if="config.mode == \'std\'"><div class=form-group><label for=sample>Datasources</label> <input id=sample type=text class=form-control ng-model=config.databaseStandard placeholder="Type du Check" autocomplete=off uib-typeahead="database for database in graph.getDatabase($viewValue)" typeahead-min-length=0 typeahead-on-select=graph.getColumns(config.databaseStandard)></div><div class=form-group><label for=sample>Colonne -> Label</label> <input id=sample type=text class=form-control ng-model=config.columnStandard autocomplete=off uib-typeahead="col as col.name for col in graph.column" typeahead-min-length=0></div><div class=form-group><label for=standardTest>Test</label></div><p ng-hide=config.principalCol.length>Choissisez une datasource !</p><div ng-if=config.principalCol.length><label><small>REF</small></label><query-builder group=config.condition.group fields=config.principalCol database=config.databaseStandard></query-builder></div><div ng-if="config.condition.group.rules[0] && config.condition.group.rules[0].data"><label><small>SEC</small></label><query-builder group=config.condition2.group fields=config.otherCol database=config.databaseStandard></query-builder></div></div><div ng-if="config.mode == \'exp\'"><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database uib-typeahead="database for database in graph.getDatabaseExpert($viewValue)" typeahead-min-length=0></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea rows=3 id=query class=form-control placeholder=Query ng-model=config.expert></textarea></div></div><hr><div><label>Configuration du Graph</label></div><input ng-if="config.mode == \'easy\'" id=listener type=checkbox ng-model=config.listener> <label ng-if="config.mode == \'easy\'" for=listener>Slave</label><div><label>Type de Graph</label></div><div class=form-group><label class=sr-only for=sample>Chart Type</label><select class=form-control ng-model=config.type><option value=pie>Camenbert</option><option value=polarArea>PolarArea</option><option value=doughnut>Doughnut</option></select></div><div><label>Label</label></div><div class=form-group><label class=sr-only for=label>Label</label> <input type=text id=label class=form-control ng-model=config.label placeholder=Label uib-typeahead="key for key in config.key" typeahead-min-length=0 autocomplete=off></div><div><label>Value</label></div><div class=form-group><label class=sr-only for=value>Value</label> <input type=text id=value class=form-control ng-model=config.value placeholder=DonnÃ©es uib-typeahead="key for key in config.key" typeahead-min-length=0 autocomplete=off></div></form>'),e.put("{widgetsPath}/pieChart/src/view/view.html",'<div><div ng-hide=graph.label class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=graph.label>{{config.urlReplace}}<div><canvas id=graph class=chart-base chart-type=graph.type chart-data=graph.value chart-labels=graph.label chart-options=graph.options></canvas></div><div><p class=text-center>{{graph.desc}}</p></div></div></div>')}]),angular.module("adf.widget.pieChart").controller("pieChartController",l),l.$inject=["$scope","data","pieChartService","$rootScope"],angular.module("adf.widget.pieChart").controller("pieChartEditController",o),o.$inject=["$scope","$http","config","pieChartService"],angular.module("adf.widget.pieChart").service("pieChartService",i),i.$inject=["$q","$http","$parse"]}(window);