!function(e,t){"use strict";function a(e){e.widget("checkValue",{title:"checkValue",description:"Widgets permettant la création de Check",templateUrl:"{widgetsPath}/checkValue/src/view/view.html",controller:"checkValueController",controllerAs:"cv",reload:!0,resolve:{data:["checkValueService","config",function(e,t){return e.get(t)}]},edit:{controller:"checkValueEditController",controllerAs:"cv",templateUrl:"{widgetsPath}/checkValue/src/edit/edit.html"}})}function o(e,t,a){function o(e,t){var o=[];return angular.forEach(e.columns,function(e,l){e.title&&e.path&&(t.headers[l]=e.title,o.push({title:e.title,path:a(e.path)}))}),o}function l(e,t){var l={headers:[],rows:[]};if(!e.columns){e.columns=[];for(var n in t[0])e.columns.push({title:n,path:n})}var i=t;e.rootData&&(i=a(e.rootData)(t));var c=o(e,l);return angular.forEach(i,function(e){var t=[];angular.forEach(c,function(a,o){var l=a.path(e);t[o]=l}),l.rows.push(t)}),l.totalItems=l.rows.length,l.columns=e.columns,l}function n(e){return t.get(e.modalUrl).then(function(e){return e.data}).then(function(t){return l(e,t)})}function i(e){var t=null;return e.modalUrl&&(t=n(e)),t}return{get:i}}function l(e){var t=this;this.data=e,this.sortIndex=function(e){return t.reverseSort=!t.reverseSort,t.orderField=e},this.sorter=function(e){return e[t.orderField]}}function n(e,t,a,o){if(a){var l=this;this.data=a,console.log(a),this.data.config.listener&&e.$on("DatTest",function(e,t){l.datTest=t}),this.configModal=l.data.config,this.data.positif=a.data>0,this.data.config.pourcent&&0==this.data.data&&(this.data.zero=!0),this.open=function(){if(l.data.config.modalUrl){t.open({templateUrl:"{widgetsPath}/checkValue/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:["modalService",function(e){return e.get(l.configModal)}]}})}}}}function i(e,t,a,o){function l(e){return e||a.columns||(a.columns=[]),e&&!a.datasources&&(a.datasources=[]),e?a.datasources:a.columns}this.config=a,e.getAutocompletion=function(e){return t.get("/api/autocomplete",{params:{val:e}}).then(function(e){return e.data})},this.addColumn=function(e){l(e).push({})},this.removeColumn=function(e,t){l(e).splice(t,1)},this.load=function(){o.get(a.url)}}function c(e,t,a){function o(e,t){t.keys=[];for(var o in e)t.keys.push(o);t.root||(t.root=t.keys[1]);var l=a(t.root)(e),n=!1;switch(t.op){case"eq":n=l==t.test;break;case"dif":n=l!=t.test;break;case"sup":n=l>t.test;break;case"inf":n=l<t.test;break;default:n=!1}t.percentData||(t.percentData=t.keys[0]);var i=a(t.percentData)(e);t.lastWeek||(t.lastWeek=t.keys[2]);var c=a(t.lastWeek)(e);return{config:t,data:l,ok:n,percentData:i,lastWeek:c}}function l(e){return t.get(e.url).then(function(e){return e.data}).then(function(t){return o(t,e)})}function n(e){var t=null;return e.expert?t=i(e):e.url&&(t=l(e)),t}function i(e){return t.post(expertUrl,e).then(function(e){return e.data}).then(function(t){return o(t,e)})}return{get:n}}angular.module("adf.widget.checkValue",["adf.provider"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.checkValue").run(["$templateCache",function(e){e.put("{widgetsPath}/checkValue/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><form role=form><input type=radio ng-model=config.mode value=easy id=std> <label for=std>Mode Facile</label> <input type=radio ng-model=config.mode value=exp id=exp> <label for=exp>Mode Expert</label><div class=form-group ng-if="config.mode == \'easy\'"><easy-mode config=config><easy-mode></easy-mode></easy-mode></div><div ng-if="config.mode == \'exp\'"><expert-mode config=config></expert-mode></div><div><label>Donnée Principal</label></div><div><div class=form-group><label for=tooltip>Description</label> <input id=tooltip type=text class=form-control ng-model=config.desc placeholder=Tooltips></div><div class=form-group><label for=sample>Donnée</label> <input type=text class=form-control ng-model=config.root placeholder="Enter name of principal data" uib-typeahead="key for key in config.keys" typeahead-min-length=0 autocomplete=off></div></div><div><label>Test</label></div><div class="form-inline padding-bottom"><div class=form-group><label class=sr-only for=op>Operation</label><select class=form-group id=op ng-model=config.op required><option value=eq>==</option><option value=sup>></option><option value=inf><</option><option value=dif>!=</option><option value=not>not</option></select></div><div class=form-group><label class=sr-only for=test>Value</label> <input type=text id=test class=form-control placeholder="Test Value" ng-model=config.test required></div></div><div><input type=checkbox ng-model=config.pourcent> <label>Pourcentage</label></div><div ng-if=config.pourcent><label class=sr-only for=sample>Donnée</label> <input type=text class=form-control ng-model=config.percentData placeholder="Enter name of principal data" uib-typeahead="key for key in config.keys" typeahead-min-length=0 autocomplete=off></div><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Modal <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><div><label for=sample>Modal URL</label> <input type=text class=form-control ng-model=config.modalUrl placeholder="Modal Url" uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cv.config.columns"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click="cv.removeColumn(false, $index)"><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cv.addColumn(false)><i class="fa fa-plus"></i> Add</button></div><input type=checkbox ng-model=config.listener> listener</form>'),e.put("{widgetsPath}/checkValue/src/edit/standard.html",'<div class=form-group><label for=sample>Liste des Datasources</label><div class="form-inline padding-bottom" ng-repeat="url in cv.config.datasources"><div class=form-group><label class=sr-only for=datasource-{{$index}}>Datasource</label> <input type=text id=datasource-{{$index}} class=form-control ng-model=url.name placeholder=Datasource uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><button type=button class="btn btn-warning" ng-click=cv.removeColumn(true,$index)><i class="fa fa-minus"></i> Remove</button></div></div><button type=button class="btn btn-primary" ng-click=cv.addColumn(true)><i class="fa fa-plus"></i> Add</button><div class=form-group><label for=standardTest>Test</label><select class=form-control><option></option></select></div>'),e.put("{widgetsPath}/checkValue/src/view/modal.html","<modal-table data=cm.data></modal-table>"),e.put("{widgetsPath}/checkValue/src/view/view.html",'<div><div ng-hide=cv.data class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=cv.data ng-click=cv.open()><div ng-if=!cv.data.config.pourcent><div class=text-center><div><i ng-show=cv.data.ok class="fa fa-check fa-4x text-success" aria-hidden=true>{{cv.data.data}}</i> <i ng-hide=cv.data.ok class="fa fa-times fa-4x text-danger" aria-hidden=true>{{cv.data.data}}</i></div><p uib-tooltip={{cv.data.config.tooltip}} tooltip-placement=bottom>{{cv.data.config.desc}} : {{cv.data.data}}</p></div></div><div ng-if=cv.data.config.pourcent><div class=row><div class=text-center><div class=inline><h1 class="no-margin inline">{{cv.data.data}}</h1><span ng-if=!cv.data.zero class="align-middle text-center percentage" uib-tooltip={{sv.data.lastWeek}}><span ng-if="cv.data.ok && cv.data.positif" class=text-success><i class="fa fa-caret-up fa-2x text-success" aria-hidden=true>{{cv.data.percentData}} %</i></span> <span ng-if="!cv.data.ok && !cv.data.positif" class=text-danger><i class="fa fa-caret-down fa-2x" aria-hidden=true>{{cv.data.percentData}} %</i></span> <span ng-if="!cv.data.ok && cv.data.positif" class=text-danger><i class="fa fa-caret-up fa-2x" aria-hidden=true>{{cv.data.percentData}} %</i></span> <span ng-if="cv.data.ok && !cv.data.positif" class=text-success><i class="fa fa-caret-down fa-2x" aria-hidden=true>{{cv.data.percentData}} %</i></span></span> <span ng-if=cv.data.zero class="text-warning text-center align-middle percentage"><i class="fa fa-caret-right fa-2x" aria-hidden=true>{{cv.data.percentData}}</i> <small>%</small></span></div><small>{{cv.data.config.desc}}</small></div></div></div><p ng-show=cv.datTest>{{cv.datTest}}</p></div></div>')}]),angular.module("adf.widget.checkValue").service("modalService",o),o.$inject=["$q","$http","$parse"],angular.module("adf.widget.checkValue").controller("modalInstanceCtrl",l),l.$inject=["data"],angular.module("adf.widget.checkValue").controller("checkValueController",n),n.$inject=["$scope","$uibModal","data","checkValueService"],angular.module("adf.widget.checkValue").controller("checkValueEditController",i),i.$inject=["$scope","$http","config","checkValueService"],angular.module("adf.widget.checkValue").service("checkValueService",c),c.$inject=["$q","$http","$parse"]}(window);