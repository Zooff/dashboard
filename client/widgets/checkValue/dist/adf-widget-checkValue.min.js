!function(e,a){"use strict";function t(e){e.widget("checkValue",{title:"checkValue",description:"Widgets permettant la création de Check",templateUrl:"{widgetsPath}/checkValue/src/view/view.html",controller:"checkValueController",controllerAs:"cv",reload:!0,resolve:{data:["checkValueService","config",function(e,a){return e.get(a)}]},edit:{controller:"checkValueEditController",controllerAs:"cv",templateUrl:"{widgetsPath}/checkValue/src/edit/edit.html"}})}function l(e,a,t){function l(e,a){var l=[];return angular.forEach(e.columns,function(e,o){e.title&&e.path&&(a.headers[o]=e.title,l.push({title:e.title,path:t(e.path)}))}),l}function o(e,a){console.log(e);var o={headers:[],rows:[]};if(console.log(a[0]),!e.columns){e.columns=[];for(var i in a[0])e.columns.push({title:i,path:i})}var n=a;e.rootData&&(n=t(e.rootData)(a));var r=l(e,o);return angular.forEach(n,function(e){var a=[];angular.forEach(r,function(t,l){var o=t.path(e);a[l]=o}),o.rows.push(a)}),o.totalItems=o.rows.length,o.columns=e.columns,console.log(o),o}function i(e){return a.get(e.modalUrl).then(function(e){return e.data}).then(function(a){return o(e,a)})}function n(e){var a=null;return e.modalUrl&&(a=i(e)),a}return{get:n}}function o(e){var a=this;this.data=e,this.sortIndex=function(e){return a.reverseSort=!a.reverseSort,a.orderField=e},this.sorter=function(e){return e[a.orderField]}}function i(e,a,t,l){if(t){var o=this;this.data=t,this.configModal=o.data.config,this.data.positif=t.data>0,this.data.config.pourcent&&0==this.data.data&&(this.data.zero=!0),this.open=function(){if(o.data.config.modalUrl){a.open({templateUrl:"{widgetsPath}/checkValue/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:function(e){return e.get(o.configModal)}}})}}}}function n(e,a,t,l){function o(){return t.columns||(t.columns=[]),t.columns}this.config=t,e.getAutocompletion=function(e){return a.get("/api/autocomplete",{params:{val:e}}).then(function(e){return e.data})},this.addColumn=function(){o().push({})},this.removeColumn=function(e){o().splice(e,1)},this.load=function(){l.get(t.url)}}function r(e,a,t){function l(e,a){if(a.principalData)var l=t(a.principalData)(e);var o=t(a.root)(e),i=!1;switch(a.op){case"eq":i=o==a.test;break;case"dif":i=o!=a.test;break;case"sup":i=o>a.test;break;case"inf":i=o<a.test;break;default:i=!1}return{config:a,data:o,ok:i,principalData:l}}function o(e){return a.get(e.url).then(function(e){return e.data}).then(function(a){return l(a,e)})}function i(e){var a=null;return e.expert?a=n(e):e.url&&(a=o(e)),a}function n(e){return a.post(expertUrl,e).then(function(e){return e.data}).then(function(a){return l(a,e)})}return{get:i}}angular.module("adf.widget.checkValue",["adf.provider"]).config(t),t.$inject=["dashboardProvider"],angular.module("adf.widget.checkValue").run(["$templateCache",function(e){e.put("{widgetsPath}/checkValue/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><form role=form><div class=form-group><label for=tooltip>Description</label> <input id=tooltip type=text class=form-control ng-model=config.tooltip placeholder=Tooltips></div><div class=form-group><label for=sample>Datasource</label> <input type=text class=form-control ng-model=config.url ng-blur=cv.load() placeholder="Enter url" uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><div><input type=checkbox ng-model=config.pourcent> <label>Pourcentage</label></div><div><label>Principal Data</label></div><div class="form-inline padding-bottom"><div class=form-group><label class=sr-only for=desc>Description</label> <input type=text id=desc class=form-control ng-model=config.desc placeholder="Enter Description of the data"></div><div class=form-group><label class=sr-only for=sample>Principal Data</label> <input type=text class=form-control ng-model=config.root placeholder="Enter name of principal data"></div></div><div><label>Test</label></div><div class="form-inline padding-bottom"><div class=form-group><label class=sr-only for=op>Operation</label><select class=form-group id=op ng-model=config.op required><option value=eq>==</option><option value=sup>></option><option value=inf><</option><option value=dif>!=</option></select></div><div class=form-group><label class=sr-only for=test>Value</label> <input type=text id=test class=form-control placeholder="Test Value" ng-model=config.test required></div></div><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Modal <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><div><label for=sample>Modal URL</label> <input type=text class=form-control ng-model=config.modalUrl placeholder="Modal Url" uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cv.config.columns"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click=cv.removeColumn($index)><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cv.addColumn()><i class="fa fa-plus"></i> Add</button></div><div class=form-group><label ng-click="isCollapsed2 = !isCollapsed2">Données Aditionnel <span ng-hide=isCollapsed2 class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed2 class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed2><div class="form-inline padding-bottom"><div><label class=sr-only>Description donnée principak</label> <input type=text class=form-control ng-model=config.descPrincipalData placeholder="Donnée Principale"></div><div><label class=sr-only>Donnée Principal</label> <input type=text class=form-control ng-model=config.principalData placeholder="Donnée Principale"></div></div><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cv.config.additionalData"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click=cv.removeColumn($index)><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cv.addColumn()><i class="fa fa-plus"></i> Add</button></div><div><input type=checkbox ng-model=expert> Expert Mode</div><div ng-show=expert><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea rows=3 id=query class=form-control placeholder=Query ng-model=config.expert></textarea></div></div></form>'),e.put("{widgetsPath}/checkValue/src/view/modal.html",'<div class=modal-header><h3 class=modal-title id=modal-title>Title</h3></div><div class=modal-body id=modal-body>{{cm.un}}<table class=table><tr><th ng-repeat="head in cm.data.headers" ng-click=cm.sortIndex($index)>{{head}}</th></tr><tr ng-repeat="row in cm.data.rows| orderBy:cm.sorter:cm.reverseSort track by $index"><td ng-repeat="col in row">{{col}}</td></tr></table></div>'),e.put("{widgetsPath}/checkValue/src/view/view.html",'<div><div ng-hide=cv.data class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=cv.data ng-click=cv.open()><div ng-if=!cv.data.config.pourcent><div class=text-center><div><h1><i ng-show=cv.data.ok class="fa fa-check fa-lg text-success" aria-hidden=true></i> <i ng-hide=cv.data.ok class="fa fa-times fa-lg text-danger" aria-hidden=true></i> {{cv.data.principalData}}</h1></div><p>{{cv.data.config.desc}} : {{cv.data.data}}</p></div></div><div ng-if=cv.data.config.pourcent><p class="small text-center" ng-if=cv.data.principalData>{{cv.data.config.descPrincipalData}} : {{cv.data.principalData}}</p><div class=text-center><div ng-if=!cv.data.zero class=align-middle><i ng-if="cv.data.ok && cv.data.positif" class="fa fa-caret-up fa-5x text-success" aria-hidden=true></i> <i ng-if="!cv.data.ok && !cv.data.positif" class="fa fa-caret-down fa-5x text-danger" aria-hidden=true></i> <i ng-if="!cv.data.ok && cv.data.positif" class="fa fa-caret-up fa-5x text-danger" aria-hidden=true></i> <i ng-if="cv.data.ok && !cv.data.positif" class="fa fa-caret-down fa-5x text-success" aria-hidden=true></i></div><i ng-if=cv.data.zero class="fa fa-caret-right fa-5x text-warning" aria-hidden=true>{{cv.data.principalData}}</i><p uib-tooltip={{cv.data.config.tooltip}} tooltip-placement=bottom>{{cv.data.config.desc}} : <span ng-show="!cv.data.zero && cv.data.ok" class=text-success>{{cv.data.data}} %</span> <span ng-show="!cv.data.zero && !cv.data.ok" class=text-danger>{{cv.data.data}} %</span> <span ng-show=cv.data.zero class=text-warning>{{cv.data.data}} %</span></p></div></div></div></div>')}]),angular.module("adf.widget.checkValue").service("modalService",l),l.$inject=["$q","$http","$parse"],angular.module("adf.widget.checkValue").controller("modalInstanceCtrl",o),o.$inject=["data"],angular.module("adf.widget.checkValue").controller("checkValueController",i),i.$inject=["$scope","$uibModal","data","checkValueService"],angular.module("adf.widget.checkValue").controller("checkValueEditController",n),n.$inject=["$scope","$http","config","checkValueService"],angular.module("adf.widget.checkValue").service("checkValueService",r),r.$inject=["$q","$http","$parse"]}(window);