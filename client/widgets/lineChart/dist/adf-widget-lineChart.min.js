!function(e,l){"use strict";function a(e){e.widget("lineChart",{title:"Graphique",description:"Widget permettant l'affichage d'histogramme et de courbe",templateUrl:"{widgetsPath}/lineChart/src/view/view.html",controller:"lineChartController",controllerAs:"graph",reload:!0,resolve:{data:["lineChartService","config",function(e,l){return e.get(l)}]},edit:{controller:"lineChartEditController",controllerAs:"graph",templateUrl:"{widgetsPath}/lineChart/src/edit/edit.html"}})}function t(e,l,a,t){if(a){var r=this;this.config=a.config,this.label=a.label,this.value=a.value,this.type=a.type,this.desc=a.desc,this.series=a.series,a.config.listener&&e.$on("DatTest",function(e,l){r.config.urlReplace=l,r.load=!0,t.get(r.config).then(function(e){r.load=!1,r.label=e.label,r.value=e.value,r.series=e.series})})}this.options={legend:{display:!0,position:"bottom"}}}function r(e,l,a,t){this.config=a,a.dataSource={},e.getAutocompletion=function(e){return l.get("/autocomplete",{params:{val:e}}).then(function(e){return e.data})}}function o(e,l,a){function t(e,l){c=[],s=[],l.key=[];var t,r,o;for(var i in e[0])l.key.push(i);l.label||(l.label=l.key[0]),t=a(l.label),l.value||(l.value=l.key[1]),r=a(l.key[1]),l.value2||(l.value2=l.key[2]),o=a(l.value2),c=e.map(function(e){return t(e)});var n=e.map(function(e){return r(e)}),d=e.map(function(e){return o(e)});return s.push(n),s.push(d),{config:l,label:c,value:s,type:l.type,desc:l.desc,series:[l.value,l.value2]}}function r(e){var a=e.url.replace(/:\w*/,e.urlReplace);return l.get(a).then(function(e){return e.data}).then(function(l){return t(l,e)})}function o(e){var l=null;return e.expert?l=i(e):e.dataSource&&(e.dataSource.selected&&(e.url=e.dataSource.selected.url),l=r(e)),l}function i(e){return l.post(n,e).then(function(e){return e.data}).then(function(l){return t(l,e)})}var n="/expert/query",c=[],s=[];return{get:o}}angular.module("adf.widget.lineChart",["adf.provider"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.lineChart").run(["$templateCache",function(e){e.put("{widgetsPath}/lineChart/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><form role=form><div class=form-group><label for=sample>Datasource</label><div ng-show=config.url class="alert alert-info text-center">{{config.url}}</div><selecttree model=config.dataSource></selecttree></div><input type=checkbox ng-model=config.listener> <label>Slave</label><div><label>Graph</label></div><div class=form-group><label class=sr-only for=desc>Description</label> <input type=text id=desc class=form-control ng-model=config.desc placeholder="Enter Description of the data"></div><div><label>Label</label></div><div class=form-group><label class=sr-only for=label>Label</label> <input type=text id=label class=form-control ng-model=config.label placeholder=Label uib-typeahead="key for key in config.key" typeahead-min-length=0 autocomplete=off></div><div><label>Value</label></div><div class=form-group><label class=sr-only for=value>Value</label> <input type=text id=value class=form-control ng-model=config.value placeholder="Première Donnée" uib-typeahead="key for key in config.key" typeahead-min-length=0></div><div class=form-group><label class=sr-only for=value2>Value2</label> <input type=text id=value2 class=form-control ng-model=config.value2 placeholder="Seconde Donnée" uib-typeahead="key for key in config.key" typeahead-min-length=0></div><div><label>Type du graph</label></div><div class=form-group><label class=sr-only for=sample>Chart Type</label><select class=form-control ng-model=config.type><option value=line>Line</option><option value=bar>Bar</option><option value=horizontalBar>Horizontal Bar</option><option value=radar>Radar</option></select></div><div><input type=checkbox ng-model=expert> Expert Mode</div><div ng-show=expert><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea id=query class=form-control rows=5 placeholder=Query ng-model=config.expert></textarea></div></div></form>'),e.put("{widgetsPath}/lineChart/src/view/view.html",'<div><div ng-hide=graph.label class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=graph.label><div><canvas id=graph class=chart-base chart-type=graph.type chart-data=graph.value chart-labels=graph.label chart-series=graph.series chart-options=graph.options></canvas></div><div><p class=text-center>{{graph.desc}}</p></div></div></div>')}]),angular.module("adf.widget.lineChart").controller("lineChartController",t),t.$inject=["$rootScope","$scope","data","lineChartService"],angular.module("adf.widget.lineChart").controller("lineChartEditController",r),r.$inject=["$scope","$http","config","lineChartService"],angular.module("adf.widget.lineChart").service("lineChartService",o),o.$inject=["$q","$http","$parse"]}(window);