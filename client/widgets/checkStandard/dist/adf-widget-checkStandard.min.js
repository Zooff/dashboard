!function(t,e){"use strict";function a(t){t.widget("checkStandard",{title:"checkStandard",description:"Widgets permettant la création de Check",templateUrl:"{widgetsPath}/checkStandard/src/view/view.html",controller:"checkStandardController",controllerAs:"cs",reload:!0,resolve:{data:["checkStandardService","config",function(t,e){return t.get(e)}]},edit:{controller:"checkStandardEditController",controllerAs:"cs",templateUrl:"{widgetsPath}/checkStandard/src/edit/edit.html"}})}function o(t,e,a){function o(t,e){var o=[];return angular.forEach(t.columns,function(t,l){t.title&&t.path&&(e.headers[l]=t.title,o.push({title:t.title,path:a(t.path)}))}),o}function l(t,e){console.log("MODAL");var l={headers:[],rows:[]};if(console.log(e),!t.columns){t.columns=[];for(var n in e[0])t.columns.push({title:n,path:n})}var r=e;t.rootData&&(r=a(t.rootData)(e));var i=o(t,l);return angular.forEach(r,function(t){var e=[];angular.forEach(i,function(a,o){var l=a.path(t);e[o]=l}),l.rows.push(e)}),l.totalItems=l.rows.length,l.columns=t.columns,l}return{createDataModel:l}}function l(t){var e=this;this.data=t,this.sortIndex=function(t){return e.reverseSort=!e.reverseSort,e.orderField=t},this.sorter=function(t){return t[e.orderField]}}function n(t,e){if(e){var a=this;e.config.tooltip&&(this.small=e.config.tooltip.substr(0,10),e.config.tooltip.length>10&&(this.small+="...")),this.data=e,this.open=function(){t.open({templateUrl:"{widgetsPath}/checkStandard/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:["modalServiceCS",function(t){return t.createDataModel(a.data.config,a.data.data)}]}})}}}function r(t,e,a,o){function l(t){return t||a.columns||(a.columns=[]),t&&!a.test&&(a.test=[]),t?a.test:a.columns}this.config=a,this.getAutocompletion=function(t){return e.get("/api/autocomplete",{params:{val:t}}).then(function(t){return t.data})},this.getDatabase=function(){return e.get("/api/standard").then(function(t){return t.data})},this.getColumns=function(t){return e.get("/api/standard/columns",{params:{val:t}}).then(function(t){return t.data}).then(function(t){a.colDatabase=t})},this.broadcast=function(){t.$broadcast("DatTest","OK")},this.addColumn=function(t){l(t).push({})},this.removeColumn=function(t,e){l(t).splice(e,1)}}function i(t,e,a){function o(t,e){return{config:e,data:t}}function l(t){var a={database:t.database,test:t.test};return e.post(i,a).then(function(t){return t.data}).then(function(e){return o(e,t)})}function n(t){var e=null;return t.expert?e=r(t):t.database&&(e=l(t)),e}function r(t){return e.post(expertUrl,t).then(function(t){return t.data}).then(function(e){return o(e,t)})}var i="/api/standard";return{get:n}}angular.module("adf.widget.checkStandard",["adf.provider"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.checkStandard").run(["$templateCache",function(t){t.put("{widgetsPath}/checkStandard/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><div class=form-group><label for=tooltip>Description</label> <input id=tooltip type=text class=form-control ng-model=config.tooltip placeholder=Tooltips></div><form role=form><div class=form-group><label for=sample>Datasources</label> <input id=sample type=text class=form-control ng-model=config.database placeholder="Type du Check" uib-typeahead="database for database in cs.getDatabase($viewValue)" typeahead-min-length=0 ng-blur=cs.getColumns(config.database)></div><div class=form-group><label for=standardTest>Test</label></div><div class="form-inline padding-bottom" ng-repeat="t in cs.config.test"><div class=form-group><label class=sr-only for=column-{{$index}}>Column</label><select class=form-control ng-model=t.column id=column-{{$index}}><option ng-repeat="column in config.colDatabase" value={{column.Field}}>{{column.Field}}</option></select></div><div class=form-group><label class=sr-only for=test-{{$index}}>Test</label><select ng-model=t.test class=form-control id=test-{{$index}}><option value="=">Egal</option><option value="<>">Different</option><option value=">">Superieur</option><option value="<">Inferieur</option></select></div><div class=form-group><label class=sr-only for=value-{{$index}}>Value</label> <input type=text class=form-control id=value-{{$index}} placeholder=Value ng-model=t.value></div><button type=button class="btn btn-warning" ng-click="cs.removeColumn(true, $index)"><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cs.addColumn(true)><i class="fa fa-plus"></i> Add</button> <input type=checkbox ng-model=config.positif> <label>Positif</label><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Modal <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cs.config.columns"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click="cs.removeColumn(false, $index)"><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cs.addColumn(false)><i class="fa fa-plus"></i> Add</button></div><button type=button ng-click=cs.broadcast()>ROOOT</button><div><input type=checkbox ng-model=expert> Expert Mode</div><div ng-show=expert><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea rows=3 id=query class=form-control placeholder=Query ng-model=config.expert></textarea></div></div></form>'),t.put("{widgetsPath}/checkStandard/src/edit/standard.html",'<div class=form-group><label for=sample>Liste des Datasources</label><div class="form-inline padding-bottom" ng-repeat="url in cv.config.datasources"><div class=form-group><label class=sr-only for=datasource-{{$index}}>Datasource</label> <input type=text id=datasource-{{$index}} class=form-control ng-model=url.name placeholder=Datasource uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><button type=button class="btn btn-warning" ng-click=cv.removeColumn(true,$index)><i class="fa fa-minus"></i> Remove</button></div></div><button type=button class="btn btn-primary" ng-click=cv.addColumn(true)><i class="fa fa-plus"></i> Add</button><div class=form-group><label for=standardTest>Test</label><select class=form-control><option></option></select></div>'),t.put("{widgetsPath}/checkStandard/src/view/modal.html",'<div class=modal-header><h3 class=modal-title id=modal-title>Title</h3></div><div class=modal-body id=modal-body><table class=table><tr><th ng-repeat="head in cm.data.headers" ng-click=cm.sortIndex($index)>{{head}}</th></tr><tr ng-repeat="row in cm.data.rows| orderBy:cm.sorter:cm.reverseSort track by $index"><td ng-repeat="col in row track by $index">{{col}}</td></tr></table></div>'),t.put("{widgetsPath}/checkStandard/src/view/view.html",'<div><div ng-hide=cs.data class="alert alert-info" role=alert>Please configure the widget</div><div class=text-center ng-show=cs.data ng-click=cs.open()><i ng-show=cs.data.config.positif class="fa fa-check fa-4x text-success" aria-hidden=true>{{cs.data.data.length}}</i> <i ng-hide=cs.data.config.positif class="fa fa-times fa-4x text-danger" aria-hidden=true>{{cs.data.data.length}}</i><p uib-tooltip={{cs.data.config.tooltip}} tooltip-placement=bottom>{{cs.small}}</p></div></div>')}]),angular.module("adf.widget.checkStandard").service("modalServiceCS",o),o.$inject=["$q","$http","$parse"],angular.module("adf.widget.checkStandard").controller("modalInstanceCtrl",l),l.$inject=["data"],angular.module("adf.widget.checkStandard").controller("checkStandardController",n),n.$inject=["$uibModal","data"],angular.module("adf.widget.checkStandard").controller("checkStandardEditController",r),r.$inject=["$rootScope","$http","config","checkStandardService"],angular.module("adf.widget.checkStandard").service("checkStandardService",i),i.$inject=["$q","$http","$parse"]}(window);