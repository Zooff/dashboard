!function(t,e){"use strict";function a(t){t.widget("checkStandard",{title:"Check Perso",description:"Widget permettant la création de Check personalisé",templateUrl:"{widgetsPath}/checkStandard/src/view/view.html",controller:"checkStandardController",controllerAs:"cs",reload:!0,resolve:{data:["checkStandardService","config",function(t,e){return t.get(e)}]},edit:{controller:"checkStandardEditController",controllerAs:"cs",templateUrl:"{widgetsPath}/checkStandard/src/edit/edit.html"}})}function o(t,e,a){function o(t,e){var o=[];return angular.forEach(t.columns,function(t,i){if(t.title&&t.path){t.title.replace(/_/," ");e.headers[i]=t.title,o.push({title:t.title,path:a(t.path)})}}),o}function i(t,e){var i={headers:[],rows:[]};if(!t.columns){t.columns=[];for(var n in e[0])t.columns.push({title:n,path:n})}var l=e;t.rootData&&(l=a(t.rootData)(e));var r=o(t,i);return angular.forEach(l,function(t){var e=[];angular.forEach(r,function(a,o){var i=a.path(t);e[o]=i}),i.rows.push(e)}),i.totalItems=i.rows.length,i.columns=t.columns,i}return{createDataModel:i}}function i(t){var e=this;this.data=t,this.sortIndex=function(t){return e.reverseSort=!e.reverseSort,e.orderField=t},this.sorter=function(t){return t[e.orderField]}}function n(t,e){if(e){var a=this;e.config.tooltip&&(this.small=e.config.tooltip.substr(0,15),e.config.tooltip.length>15&&(this.small+="...")),this.data=e,this.data.config.seuil&&(">"===e.config.seuil.op&&(this.data.positif=this.data.data.length>this.data.config.seuil.value,console.log(this.data.positif)),"<"===e.config.seuil.op&&(this.data.positif=this.data.data.length<this.data.config.seuil.value),"="===e.config.seuil.op&&(this.data.positif=this.data.data.length==this.data.config.seuil.value)),this.open=function(){t.open({templateUrl:"{widgetsPath}/checkStandard/src/view/modal.html",controller:"modalInstanceCtrlCS",controllerAs:"cm",size:"lg",windowClass:"my-modal",resolve:{data:["modalServiceCS",function(t){return t.createDataModel(a.data.config,a.data.data)}]}})}}}function l(t,e,a,o,i){function n(t){t.forEach(function(t){"principal"==t.type?r.config.principalCol.push(t):r.config.otherCol.push(t)})}function l(t){return t||o.columns||(o.columns=[]),t&&!o.test&&(o.test=[]),t?o.test:o.columns}var r=this;this.config=o,r.config.principalCol||(r.config.principalCol=[]),r.config.otherCol||(r.config.otherCol=[]),o.condition||(o.condition={group:{operator:"AND",rules:[]}}),o.condition2||(o.condition2={group:{operator:"AND",rules:[]}}),this.getDatabaseExpert=function(){return a.get("/expert").then(function(t){return t.data})},this.getDatabase=function(){return a.get("/standard").then(function(t){return t.data})},this.getColumns=function(t){return a.get("/standard/columns",{params:{val:t}}).then(function(t){return t.data}).then(function(t){console.log(t),n(t)})},this.addColumn=function(t){l(t).push({})},this.removeColumn=function(t,e){l(t).splice(e,1)}}function r(t,e,a){function o(t,e){return{config:e,data:t}}function i(t){var a={database:t.databaseStandard,test:t.condition,test2:t.condition2};return e.post(r,a).then(function(t){return t.data}).then(function(e){return o(e,t)})}function n(t){var e=null;return t.expert?e=l(t):t.databaseStandard&&(e=i(t)),e}function l(t){return e.post(d,t).then(function(t){return t.data}).then(function(e){return o(e,t)})}var r="/standard",d="/expert/query";return{get:n}}angular.module("adf.widget.checkStandard",["adf.provider"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.checkStandard").run(["$templateCache",function(t){t.put("{widgetsPath}/checkStandard/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><div class=form-group><label for=tooltip>Description</label> <input id=tooltip type=text class=form-control ng-model=config.tooltip placeholder="Entrer une description du check"></div><form role=form><hr><input type=radio ng-model=config.mode value=std id=std> <label for=std>Mode Standard</label> <input type=radio ng-model=config.mode value=exp id=exp> <label for=exp>Mode Expert</label><div ng-if="config.mode == \'std\'"><div class=form-group><label for=sample>Datasources</label> <input id=sample type=text class=form-control ng-model=config.databaseStandard placeholder="Type du Check" autocomplete=off uib-typeahead="database for database in cs.getDatabase($viewValue)" typeahead-min-length=0 typeahead-on-select=cs.getColumns(config.databaseStandard)></div><div class=form-group><label for=standardTest>Test</label></div><p ng-hide=config.principalCol.length>Choissisez une datasource !</p><div ng-if=config.principalCol.length><label><small>REF</small></label><query-builder group=config.condition.group fields=config.principalCol database=config.databaseStandard></query-builder></div><div ng-if="config.condition.group.rules[0] && config.condition.group.rules[0].data"><label><small>SEC</small></label><query-builder group=config.condition2.group fields=config.otherCol database=config.databaseStandard></query-builder></div></div><div ng-if="config.mode == \'exp\'"><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database uib-typeahead="database for database in cs.getDatabaseExpert($viewValue)" typeahead-min-length=0></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea rows=3 id=query class=form-control placeholder=Query ng-model=config.expert></textarea></div></div><hr><div class=form-group><label>Seuil</label></div><div class="form-inline padding-bottom"><select ng-model=config.seuil.op class=form-control><option value="=" selected>Egal</option><option value=">">Superieur</option><option value="<">Inferieur</option></select><input type=text ng-model=config.seuil.value class=form-control placeholder="Valeur du seuil"></div><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Tableau <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><p>Ce tableau s\'affiche lorsque vous cliquer sur le widget, il contient des informations plus détaillé sur le résultat du check. La première configuration est automatique</p><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cs.config.columns"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click="cs.removeColumn(false, $index)"><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cs.addColumn(false)><i class="fa fa-plus"></i> Add</button></div></form>'),t.put("{widgetsPath}/checkStandard/src/view/modal.html","<div class=modal-header><button type=button class=close ng-click=$dismiss() aria-hidden=true>&times;</button><h3 class=modal-title id=modal-title>Title</h3></div><div class=modal-body id=modal-body><modal-table data=cm.data></modal-table></div>"),t.put("{widgetsPath}/checkStandard/src/view/view.html",'<div><div ng-hide=cs.data class="alert alert-info" role=alert>Please configure the widget</div><div class=text-center ng-show=cs.data ng-click=cs.open()><i ng-show=cs.data.positif class="fa fa-check fa-4x text-success" aria-hidden=true>{{cs.data.data.length}}</i> <i ng-hide=cs.data.positif class="fa fa-times fa-4x text-danger" aria-hidden=true>{{cs.data.data.length}}</i><p uib-tooltip={{cs.data.config.tooltip}} tooltip-placement=bottom>{{cs.small}}</p></div></div>')}]),angular.module("adf.widget.checkStandard").service("modalServiceCS",o),o.$inject=["$q","$http","$parse"],angular.module("adf.widget.checkStandard").controller("modalInstanceCtrlCS",i),i.$inject=["data"],angular.module("adf.widget.checkStandard").controller("checkStandardController",n),n.$inject=["$uibModal","data"],angular.module("adf.widget.checkStandard").controller("checkStandardEditController",l),l.$inject=["$rootScope","$scope","$http","config","checkStandardService"],angular.module("adf.widget.checkStandard").service("checkStandardService",r),r.$inject=["$q","$http","$parse"]}(window);