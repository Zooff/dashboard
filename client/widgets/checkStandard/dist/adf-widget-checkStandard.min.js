!function(a,t){"use strict";function e(a){a.widget("checkStandard",{title:"checkStandard",description:"Widgets permettant la création de Check",templateUrl:"{widgetsPath}/checkStandard/src/view/view.html",controller:"checkStandardController",controllerAs:"cs",reload:!0,resolve:{data:["checkStandardService","config",function(a,t){return a.get(t)}]},edit:{controller:"checkStandardEditController",controllerAs:"cs",templateUrl:"{widgetsPath}/checkStandard/src/edit/edit.html"}})}function n(a,t,e){function n(a,t){var n=[];return angular.forEach(a.columns,function(a,r){a.title&&a.path&&(t.headers[r]=a.title,n.push({title:a.title,path:e(a.path)}))}),n}function r(a,t){var r={headers:[],rows:[]};if(!a.columns){a.columns=[];for(var o in t[0])a.columns.push({title:o,path:o})}var i=t;a.rootData&&(i=e(a.rootData)(t));var l=n(a,r);return angular.forEach(i,function(a){var t=[];angular.forEach(l,function(e,n){var r=e.path(a);t[n]=r}),r.rows.push(t)}),r.totalItems=r.rows.length,r.columns=a.columns,r}function o(a){return t.get(a.modalUrl).then(function(a){return a.data}).then(function(t){return r(a,t)})}function i(a){var t=null;return a.modalUrl&&(t=o(a)),t}return{get:i}}function r(a){var t=this;this.data=a,this.sortIndex=function(a){return t.reverseSort=!t.reverseSort,t.orderField=a},this.sorter=function(a){return a[t.orderField]}}function o(a,t,e,n){if(e){var r=this;this.data=e,this.configModal=r.data.config,this.data.positif=e.data>0,this.data.config.pourcent&&0==this.data.data&&(this.data.zero=!0),this.open=function(){if(r.data.config.modalUrl){t.open({templateUrl:"{widgetsPath}/checkStandard/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:["modalService",function(a){return a.get(r.configModal)}]}})}}}}function i(a,t,e,n){function r(a){return a||e.columns||(e.columns=[]),a&&!e.datasources&&(e.datasources=[]),a?e.datasources:e.columns}this.config=e,this.getAutocompletion=function(a){return t.get("/api/autocomplete",{params:{val:a}}).then(function(a){return a.data})},this.getDatabase=function(){return t.get("/api/standard").then(function(a){return a.data})},this.getColumns=function(a){return t.get("/api/standard/column",{params:{val:a}}).then(function(a){return a.data})},this.addColumn=function(a){r(a).push({})},this.removeColumn=function(a,t){r(a).splice(t,1)},this.load=function(){n.get(e.url)}}function l(a,t,e){function n(a,t){if(t.principalData)var n=e(t.principalData)(a);var r=e(t.root)(a),o=!1;switch(t.op){case"eq":o=r==t.test;break;case"dif":o=r!=t.test;break;case"sup":o=r>t.test;break;case"inf":o=r<t.test;break;default:o=!1}return{config:t,data:r,ok:o,principalData:n}}function r(a){return t.get(a.url).then(function(a){return a.data}).then(function(t){return n(t,a)})}function o(a){var t=null;return a.expert?t=i(a):a.url&&(t=r(a)),t}function i(a){return t.post(expertUrl,a).then(function(a){return a.data}).then(function(t){return n(t,a)})}return{get:o}}angular.module("adf.widget.checkStandard",["adf.provider"]).config(e),e.$inject=["dashboardProvider"],angular.module("adf.widget.checkStandard").run(["$templateCache",function(a){a.put("{widgetsPath}/checkStandard/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><div class=form-group><label for=tooltip>Description</label> <input id=tooltip type=text class=form-control ng-model=config.tooltip placeholder=Tooltips></div><form role=form><div class=form-group><label for=sample>Liste des Datasources</label> <input id=sample type=text class=form-control ng-model=config.database placeholder="Type du Check" uib-typeahead="database for database in getDatabase($viewValue)" ng-blur=cs.getColumns(config.database)></div><div class=form-group><label for=standardTest>Test</label><select class=form-control><option></option></select></div><div class=form-group><label ng-click="isCollapsed = !isCollapsed">Paramètre Modal <span ng-hide=isCollapsed class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed><div><label for=sample>Modal URL</label> <input type=text class=form-control ng-model=config.modalUrl placeholder="Modal Url" uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><div><label>Column</label></div><div class="form-inline padding-bottom" ng-repeat="col in cs.config.columns"><div class=form-group><label class=sr-only for=title-{{$index}}>Title</label> <input type=text id=title-{{$index}} class=form-control placeholder=Title ng-model=col.title required></div><div class=form-group><label class=sr-only for=path-{{$index}}>Path</label> <input type=text id=path-{{$index}} class=form-control placeholder=Path ng-model=col.path required></div><button type=button class="btn btn-warning" ng-click="cs.removeColumn(false, $index)"><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=cs.addColumn(false)><i class="fa fa-plus"></i> Add</button></div><div><input type=checkbox ng-model=expert> Expert Mode</div><div ng-show=expert><div class=form-group><label class=sr-only for=database>Database</label> <input type=text id=database class=form-control placeholder=Database ng-model=config.database></div><div class=form-group><label class=sr-only for=query>Query</label> <textarea rows=3 id=query class=form-control placeholder=Query ng-model=config.expert></textarea></div></div></form>'),a.put("{widgetsPath}/checkStandard/src/edit/standard.html",'<div class=form-group><label for=sample>Liste des Datasources</label><div class="form-inline padding-bottom" ng-repeat="url in cv.config.datasources"><div class=form-group><label class=sr-only for=datasource-{{$index}}>Datasource</label> <input type=text id=datasource-{{$index}} class=form-control ng-model=url.name placeholder=Datasource uib-typeahead="address.url as address.url for address in getAutocompletion($viewValue)" typeahead-template-url=autocomplete.html typeahead-loading=load typeahead-no-result=noResults></div><button type=button class="btn btn-warning" ng-click=cv.removeColumn(true,$index)><i class="fa fa-minus"></i> Remove</button></div></div><button type=button class="btn btn-primary" ng-click=cv.addColumn(true)><i class="fa fa-plus"></i> Add</button><div class=form-group><label for=standardTest>Test</label><select class=form-control><option></option></select></div>'),a.put("{widgetsPath}/checkStandard/src/view/modal.html",'<div class=modal-header><h3 class=modal-title id=modal-title>Title</h3></div><div class=modal-body id=modal-body>{{cm.un}}<table class=table><tr><th ng-repeat="head in cm.data.headers" ng-click=cm.sortIndex($index)>{{head}}</th></tr><tr ng-repeat="row in cm.data.rows| orderBy:cm.sorter:cm.reverseSort track by $index"><td ng-repeat="col in row track by $index">{{col}}</td></tr></table></div>'),a.put("{widgetsPath}/checkStandard/src/view/view.html",'<div><div ng-hide=cv.data class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=cv.data ng-click=cv.open()><div ng-if=!cv.data.config.pourcent><div class=text-center><div><i ng-show=cv.data.ok class="fa fa-check fa-4x text-success" aria-hidden=true>{{cv.data.principalData}}</i> <i ng-hide=cv.data.ok class="fa fa-times fa-4x text-danger" aria-hidden=true>{{cv.data.principalData}}</i></div><p uib-tooltip={{cv.data.config.tooltip}} tooltip-placement=bottom>{{cv.data.config.desc}} : {{cv.data.data}}</p></div></div><div ng-if=cv.data.config.pourcent><div class=text-center><div ng-if=!cv.data.zero class=align-middle><i ng-if="cv.data.ok && cv.data.positif" class="fa fa-caret-up fa-5x text-success" aria-hidden=true>{{cv.data.principalData}}</i> <i ng-if="!cv.data.ok && !cv.data.positif" class="fa fa-caret-down fa-5x text-danger" aria-hidden=true>{{cv.data.principalData}}</i> <i ng-if="!cv.data.ok && cv.data.positif" class="fa fa-caret-up fa-5x text-danger" aria-hidden=true>{{cv.data.principalData}}</i> <i ng-if="cv.data.ok && !cv.data.positif" class="fa fa-caret-down fa-5x text-success" aria-hidden=true>{{cv.data.principalData}}</i></div><i ng-if=cv.data.zero class="fa fa-caret-right fa-5x text-warning" aria-hidden=true>{{cv.data.principalData}}</i><p uib-tooltip={{cv.data.config.tooltip}} tooltip-placement=bottom>{{cv.data.config.desc}} : <span ng-show="!cv.data.zero && cv.data.ok" class=text-success>{{cv.data.data}} %</span> <span ng-show="!cv.data.zero && !cv.data.ok" class=text-danger>{{cv.data.data}} %</span> <span ng-show=cv.data.zero class=text-warning>{{cv.data.data}} %</span></p></div></div></div></div>')}]),angular.module("adf.widget.checkStandard").service("modalService",n),n.$inject=["$q","$http","$parse"],angular.module("adf.widget.checkStandard").controller("modalInstanceCtrl",r),r.$inject=["data"],angular.module("adf.widget.checkStandard").controller("checkStandardController",o),o.$inject=["$scope","$uibModal","data","checkStandardService"],angular.module("adf.widget.checkStandard").controller("checkStandardEditController",i),i.$inject=["$scope","$http","config","checkStandardService"],angular.module("adf.widget.checkStandard").service("checkStandardService",l),l.$inject=["$q","$http","$parse"]}(window);