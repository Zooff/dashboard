!function(e,t){"use strict";function a(e){e.widget("singleValue",{title:"Affichage Simple",description:"Affiche une donnée",templateUrl:"{widgetsPath}/singleValue/src/view/view.html",controller:"singleValueController",controllerAs:"sv",reload:!0,resolve:{data:["singleValueService","config",function(e,t){return e.get(t)}]},edit:{controller:"singleValueEditController",controllerAs:"sv",templateUrl:"{widgetsPath}/singleValue/src/edit/edit.html"}})}function n(e,t,a,n,l,o){if(n){var i=this;this.data=n,this.config=n.config,i.getSeuilColor=function(){return"Sup"==i.config.seuilOp?i.config.seuilVal>i.data.principalData.data?"text-success":"text-danger":"Inf"==i.config.seuilOp?i.config.seuilVal<i.data.principalData.data?"text-success":"text-danger":"Eg"==i.config.seuilOp?i.config.seuilVal==i.data.principalData.data?"text-success":"text-danger":void 0},i.config.listener&&t.$on("DatTest",function(e,t){i.config.expertReplace=t,i.config.urlReplace=t[i.config.slaveValue],i.data.load=!0,l.get(i.data.config).then(function(e){i.data.load=!1,i.data=e})}),i.open=function(){if(i.config.modal||i.config.link){if(i.config.expertReplace)var t=i.config.expertReplace;else var t={};if(i.config.colToPop&&i.config.colToPop.forEach(function(e){t[e.name]=n.jsondata[e.name]}),i.config.master)return void e.$broadcast("DatTest",t);if(console.log("BUG"),i.config.link)return void o.redirect(i.config,t);if(i.config.modal){$uibModal.open({templateUrl:"{widgetsPath}/singleValue/src/view/modal.html",controller:"modalInstanceCtrl",controllerAs:"cm",resolve:{data:["modalServiceSV",function(e){return e.get(i.config)}]}})}}}}}function l(e,t,a){function n(e,t){var n=[];return angular.forEach(e.columns,function(e,l){if(e.title&&e.path){var o=e.title.replace(/_/," ");o=o.replace(/^bool/,""),t.headers[l]=e.title,n.push({title:e.title,path:a(e.path)})}}),n}function l(e,t){var l={headers:[],rows:[]};if(!e.columns||!e.columns.length){e.columns=[];for(var o in t[0])e.columns.push({title:o,path:o})}var i=t;e.rootData&&(i=a(e.rootData)(t));var r=n(e,l);return angular.forEach(i,function(e){var t=[];angular.forEach(r,function(a,n){var l=a.path(e);t[n]=l}),l.rows.push(t)}),l.totalItems=l.rows.length,l.columns=e.columns,l}function o(e){console.log(e);var a=e.modal.url.replace(/:\w+/,e.urlReplace);return t.get(a).then(function(e){return e.data}).then(function(t){return l(e.modal,t)})}function i(e){var a="/expert/query";return e.modal.expertReplace=e.expertReplace,t.post(a,e.modal).then(function(e){return console.error(e),e.data}).then(function(t){return l(e.modal,t)})}function r(e){var t=null;return"exp"==e.modal.modalMode?t=i(e):(e.modal.modalMode="easy")&&(e.modal.datasource.selected&&(e.modal.url=e.modal.datasource.selected.url),t=o(e)),t}return{get:r}}function o(e){var t=this;this.data=e,this.sortIndex=function(e){return t.reverseSort=!t.reverseSort,t.orderField=e},this.sorter=function(e){return e[t.orderField]}}function i(e,t,a){function n(){return a.columns||(a.columns=[]),a.columns}function l(){return a.colToPop||(a.colToPop=[]),a.colToPop}this.config=a,a.datasource={},this.getDatabase=function(){return t.get("/expert").then(function(e){return e.data})},this.addColumn=function(){n().push({})},this.removeColumn=function(e){n().splice(e,1)},this.addColToPop=function(){l().push({})},this.removeColToPop=function(e){l().splice(e,1)}}function r(e,t,a){function n(e){var t=[];return angular.forEach(e.columns,function(e,n){e.path&&t.push({title:e.title,path:a(e.path)})}),t}function l(e,t){var l={config:e,principalData:{},additionalData:[],jsondata:t};e.list=[];for(var o in t)e.list.push(o);if(e.root){var i=a(e.root)(t);l.principalData={desc:e.desc,data:i}}var r=n(e);return angular.forEach(r,function(e,a){var n=e.path(t);l.additionalData.push({title:e.title,data:n})}),l}function o(e){var a=e.url.replace(/:\w*/,e.urlReplace);return t.get(a).then(function(e){return e.data}).then(function(t){return l(e,t[0])})}function i(e){var t=null;return e.expert?t=r(e):e.datasource&&(e.datasource.selected&&(e.url=e.datasource.selected.url),t=o(e)),t}function r(e){return t.post(c,e).then(function(e){return e.data}).then(function(t){if(t.code){({data:t.code}),{config:e,principalData:principalData1}}return l(e,t[0])})}var c="/expert/query";return{get:i}}angular.module("adf.widget.singleValue",["adf.provider"]).config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.singleValue").run(["$templateCache",function(e){e.put("{widgetsPath}/singleValue/src/edit/edit.html",'<script type=text/ng-template id=autocomplete.html><a> <span ng-bind-html="match.model.url | uibTypeaheadHighlight:query"></span> | <small ng-bind-html="match.model.desc | uibTypeaheadHighlight:query"></small> </a></script><form role=form><input type=radio ng-model=config.mode value=easy id=easy> <label for=easy>Mode Facile</label> <input type=radio ng-model=config.mode value=exp id=exp> <label for=exp>Mode Expert</label><div class=form-group ng-if="config.mode == \'easy\'"><easy-mode config=config><easy-mode></easy-mode></easy-mode></div><div ng-if="config.mode == \'exp\'"><expert-mode config=config></expert-mode></div><hr><input type=checkbox ng-model=config.listener> <label>Slave</label><div ng-if=config.listener><label>Master Column</label> <input type=text ng-model=config.slaveValue><hr></div><div><label>Donnée</label></div><div class=form-group><label class=sr-only for=sample>Principal Data</label><select ng-model=config.root class=form-control><option ng-repeat="el in config.list" value={{el}}>{{el}}</option></select></div><div class=form-group><label for=desc>Label</label> <input type=text id=desc class=form-control ng-model=config.desc placeholder="Entrer la description de la donnée"></div><hr><label>Formatage</label><div><input id=percent type=radio ng-model=config.format value=percent> <label for=percent>Pourcentage</label> <input id=custom type=radio ng-model=config.format value=custom> <label for=custom>Custom</label></div><div ng-if="config.format == \'custom\'"><div class=row><div class=col-md-6><label>Prefix</label> <input type=text ng-model=config.custom.prepend></div><div class=col-md-6><label>Suffixe</label> <input type=text ng-model=config.custom.append></div></div></div><label>Seuil</label><div class="form-inline padding-bottom"><select ng-model=config.seuilOp><option value=Sup>Sup</option><option value=Inf>Inf</option><option value=Eg>Eg</option></select><input type=text ng-model=config.seuilVal></div><div><label ng-click="isCollapsed3 = !isCollapsed3">Paramètre Optionnel <span ng-hide=isCollapsed3 class="glyphicon glyphicon-triangle-bottom" aria-hidden=true></span> <span ng-show=isCollapsed3 class="glyphicon glyphicon-triangle-top" aria-hidden=true></span></label></div><div ng-show=isCollapsed3><div><label for=field>Column to populate</label></div><div class="form-inline padding-bottom" ng-repeat="c in sv.config.colToPop"><div class=form-group><input type=text id=field autocomplete=off uib-typeahead="key for key in config.list" typeahead-min-length=0 ng-model=c.name></div><button type=button class="btn btn-warning" ng-click=sv.removeColToPop($index)><i class="fa fa-minus"></i> Remove</button></div><button type=button class="btn btn-primary" ng-click=sv.addColToPop()><i class="fa fa-plus"></i> Add</button><hr><my-link config=config></my-link><hr><div><label>Modal Configuration</label></div><modal-config config=config.modal></modal-config></div></form>'),e.put("{widgetsPath}/singleValue/src/view/modal.html","<modal-table data=cm.data></modal-table>"),e.put("{widgetsPath}/singleValue/src/view/view.html",'<div><div ng-hide=sv.data class="alert alert-info" role=alert>Please insert a url to the widget configuration</div><div ng-show=!sv.data.load><div class="text-center col-md-12" ng-click=sv.open() ng-class="{click : sv.config.link || sv.config.modal}"><h3 style="word-wrap: break-word" ng-class=sv.getSeuilColor()><span ng-if="sv.data.config.format == \'custom\'">{{sv.data.config.custom.prepend}}</span> {{sv.data.principalData.data}} <span ng-if="sv.data.config.format == \'percent\'">%</span> <span ng-if="sv.data.config.format == \'custom\'">{{sv.data.config.custom.append}}</span></h3><p class="text-center small">{{sv.data.principalData.desc}}</p></div><ul class="list-inline text-center"><li ng-repeat="addData in sv.data.additionalData">{{addData.title}} : {{addData.data}}</li></ul></div><div ng-hide=!sv.data.load class=text-center><i class="fa fa-spinner fa-pulse fa-3x" aria-hidden=true></i></div></div>')}]),angular.module("adf.widget.singleValue").controller("singleValueController",n),n.$inject=["$rootScope","$scope","$timeout","data","singleValueService","link"],angular.module("adf.widget.singleValue").service("modalServiceSV",l),l.$inject=["$q","$http","$parse"],angular.module("adf.widget.singleValue").controller("modalInstanceCtrl",o),o.$inject=["data"],angular.module("adf.widget.singleValue").controller("singleValueEditController",i),i.$inject=["$scope","$http","config"],angular.module("adf.widget.singleValue").service("singleValueService",r),r.$inject=["$q","$http","$parse"]}(window);